% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_schoenfeld.R
\name{plot_schoenfeld}
\alias{plot_schoenfeld}
\title{Plot Scaled Schoenfeld Residuals for Proportional Hazards Assumption Testing}
\usage{
plot_schoenfeld(dataset, control_arm = NULL)
}
\arguments{
\item{dataset}{A data frame containing survival analysis data with columns:
ARM (treatment arm), SURVTIME (survival time), EVENT (event indicator)}

\item{control_arm}{Character string specifying which ARM level should be used as
the reference (control) group. If NULL (default), uses the first factor level}
}
\value{
A ggplot object:
\itemize{
\item Single plot without facet if ARM has 2 levels
\item Horizontal facet panels if ARM has 3+ levels with shared y-axis
}
}
\description{
This function creates scaled Schoenfeld residual plots to test the proportional
hazards assumption in Cox regression models. It supports multiple treatment arms.
}
\details{
The function performs the following operations:
\itemize{
\item Fits Cox proportional hazards model using \code{survival::coxph()}
\item Tests proportional hazards assumption using \code{survival::cox.zph()}
\item Creates scaled Schoenfeld residual plots for each treatment comparison
\item Adds LOESS smoothing curve to visualize time-varying effects
\item Displays beta coefficient and p-value on each plot
}

The proportional hazards assumption is satisfied if:
\itemize{
\item The LOESS curve is approximately horizontal (parallel to y = 0)
\item The p-value from Grambsch-Therneau test is > 0.05
}

Colors used in plots:
\itemize{
\item Points: #004C97 (blue)
\item LOESS curve: #F0B323 (gold)
\item Reference line (y = 0): #D91E49 (red)
\item Green (#658D1B) for p >= 0.05, Red (#D91E49) for p < 0.05
}

Diagnostic information is printed to console showing:
\itemize{
\item ARM coefficient name
\item Beta value
\item P-value from proportional hazards test
\item Number of events
\item Residuals range
}
}
\examples{
\dontrun{
# Example 1: Basic two-arm analysis
dataset <- generate_dummy_survival_data(
  arm = c("Treatment", "Control"),
  n = c(100, 100),
  hazards = log(2) / c(20, 15),
  dropout_per_year = 0.1,
  seed = 123
)

dataset_processed <- processing_dataset(
  dataset = dataset,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Plot
p1 <- plot_schoenfeld(dataset = dataset_processed)
print(p1)

# Example 2: Three-arm trial with specified control
dataset2 <- generate_dummy_survival_data(
  arm = c("Treatment1", "Treatment2", "Control"),
  n = c(100, 100, 100),
  hazards = log(2) / c(20, 18, 15),
  dropout_per_year = 0.1,
  seed = 456
)

dataset2_processed <- processing_dataset(
  dataset = dataset2,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Plot with Control as reference (2 plots: Treatment1 vs Control, Treatment2 vs Control)
p2 <- plot_schoenfeld(
  dataset = dataset2_processed,
  control_arm = "Control"
)
print(p2)

# Example 3: Four-arm trial
dataset3 <- generate_dummy_survival_data(
  arm = c("A", "B", "C", "Control"),
  n = c(100, 100, 100, 100),
  hazards = log(2) / c(22, 18, 16, 15),
  dropout_per_year = 0.1,
  seed = 789
)

dataset3_processed <- processing_dataset(
  dataset = dataset3,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Creates 3 panels (A vs Control, B vs Control, C vs Control)
p3 <- plot_schoenfeld(
  dataset = dataset3_processed,
  control_arm = "Control"
)
print(p3)
}
}
