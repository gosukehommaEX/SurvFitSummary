% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_qq_survival.R
\name{plot_qq_survival}
\alias{plot_qq_survival}
\title{Plot Q-Q Plots for Survival Time Distributions}
\usage{
plot_qq_survival(dataset, control_arm = NULL)
}
\arguments{
\item{dataset}{A data frame containing survival analysis data with columns:
ARM (treatment arm), SURVTIME (survival time), EVENT (event indicator)}

\item{control_arm}{Character string specifying which ARM level should be used as
the reference (control) group for comparison. If NULL (default), uses the
first factor level. Required when ARM has 3+ levels}
}
\value{
A ggplot object containing:
\itemize{
\item Single Q-Q plot if ARM has 2 levels
\item Faceted Q-Q plots if ARM has 3+ levels, each comparing
a treatment arm against the control arm
\item NULL if ARM has only 1 level (with informative message)
}
Each plot includes:
\itemize{
\item Observed quantiles (red points)
\item Identity line y = x (dashed black line)
\item Linear regression fit with 95\% CI (gray solid line with shaded area)
}
}
\description{
This function creates quantile-quantile (Q-Q) plots to compare survival time
distributions between treatment arms. For 2-arm trials, it creates a single
Q-Q plot. For 3+ arms, it creates faceted Q-Q plots comparing each treatment
arm against the control arm.
}
\details{
The function performs the following operations:
\itemize{
\item Checks if ARM has at least 2 levels; returns NULL with message if not
\item Fits Kaplan-Meier curves for each ARM using \code{survival::survfit()}
\item Extracts survival quantiles at percentiles: 0.05, 0.10, ..., 0.95
\item Creates Q-Q plots comparing quantiles between arms
\item Adds linear regression fit to assess distributional similarity
}

Interpretation guidelines:
\itemize{
\item \strong{Points near identity line}: Survival distributions are similar
\item \strong{Points above identity line}: Y-arm has longer survival times
\item \strong{Points below identity line}: Y-arm has shorter survival times
\item \strong{Non-linear pattern}: Different distributional shapes
}

Colors and styling:
\itemize{
\item Observed quantiles: #D91E49 (red points)
\item Identity line: Black dashed
\item Regression fit: #939597 (gray) with 95\% CI
}
}
\examples{
\dontrun{
# Example 1: Two-arm trial
dataset1 <- generate_dummy_survival_data(
  arm = c("Treatment", "Control"),
  n = c(100, 100),
  hazards = log(2) / c(20, 15),
  dropout_per_year = 0.1,
  seed = 123
)

dataset1_processed <- processing_dataset(
  dataset = dataset1,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Single Q-Q plot
p1 <- plot_qq_survival(dataset1_processed)
print(p1)

# Example 2: Three-arm trial with specified control
dataset2 <- generate_dummy_survival_data(
  arm = c("Treatment1", "Treatment2", "Control"),
  n = c(100, 100, 100),
  hazards = log(2) / c(22, 18, 15),
  dropout_per_year = 0.1,
  seed = 456
)

dataset2_processed <- processing_dataset(
  dataset = dataset2,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Faceted Q-Q plots (Treatment1 vs Control, Treatment2 vs Control)
p2 <- plot_qq_survival(
  dataset = dataset2_processed,
  control_arm = "Control"
)
print(p2)

# Example 3: Four-arm trial
dataset3 <- generate_dummy_survival_data(
  arm = c("TrtA", "TrtB", "TrtC", "Control"),
  n = c(80, 80, 80, 80),
  hazards = log(2) / c(24, 20, 18, 15),
  dropout_per_year = 0.1,
  seed = 789
)

dataset3_processed <- processing_dataset(
  dataset = dataset3,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Three faceted Q-Q plots (TrtA vs Control, TrtB vs Control, TrtC vs Control)
p3 <- plot_qq_survival(
  dataset = dataset3_processed,
  control_arm = "Control"
)
print(p3)

# Example 4: Single ARM (returns NULL with message)
dataset4 <- generate_dummy_survival_data(
  arm = c("DrugA"),
  n = c(200),
  hazards = log(2) / 18,
  dropout_per_year = 0.1,
  seed = 101
)

dataset4_processed <- processing_dataset(
  dataset = dataset4,
  column_arm = "ARM",
  column_survtime = "SURVTIME",
  column_cnsr = "CNSR",
  column_event = NULL
)

# Returns NULL with message
p4 <- plot_qq_survival(dataset4_processed)
# Message: "Q-Q plot requires at least 2 ARM levels for comparison.
#          Found: 1 level(s). Returning NULL."
}
}
